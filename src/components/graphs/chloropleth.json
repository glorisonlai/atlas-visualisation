{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "COVID-19 Active Cases (10 Oct 2020)",
  "width": 800,
  "height": 600,
  "projection": { "type": "equirectangular" },
  "data": {
    "url": "https://raw.githubusercontent.com/KaneSec/vega_lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
    "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
  },
  "params": [
    {
      "name": "YearFilter",
      "value": 1961,
      "bind": {
        "input": "range",
        "min": 1961,
        "max": 2019,
        "step": 1
      }
    }
  ],
  "mark": { "type": "geoshape" },
  "transform": [
    {
      "lookup": "properties.NAME",
      "from": {
        "data": {
          "url": "atlas-visualisation/Environment_Temperature_change_E_All_Data_NOFLAG.csv"
        },
        "key": "Area",
        "fields": [
          "Months Code",
          "Y1961",
          "Y1962",
          "Y1963",
          "Y1964",
          "Y1965",
          "Y1966",
          "Y1967",
          "Y1968",
          "Y1969",
          "Y1970",
          "Y1971",
          "Y1972",
          "Y1973",
          "Y1974",
          "Y1975",
          "Y1976",
          "Y1977",
          "Y1978",
          "Y1979",
          "Y1980",
          "Y1981",
          "Y1982",
          "Y1983",
          "Y1984",
          "Y1985",
          "Y1986",
          "Y1987",
          "Y1988",
          "Y1989",
          "Y1990",
          "Y1991",
          "Y1992",
          "Y1993",
          "Y1994",
          "Y1995",
          "Y1996",
          "Y1997",
          "Y1998",
          "Y1999",
          "Y2000",
          "Y2001",
          "Y2002",
          "Y2003",
          "Y2004",
          "Y2005",
          "Y2006",
          "Y2007",
          "Y2008",
          "Y2009",
          "Y2010",
          "Y2011",
          "Y2012",
          "Y2013",
          "Y2014",
          "Y2015",
          "Y2016",
          "Y2017",
          "Y2018",
          "Y2019"
        ]
      }
    },
    { "filter": { "field": "Months Code", "equal": "7020" } },
    {
      "fold": [
        "Y1961",
        "Y1962",
        "Y1963",
        "Y1964",
        "Y1965",
        "Y1966",
        "Y1967",
        "Y1968",
        "Y1969",
        "Y1970",
        "Y1971",
        "Y1972",
        "Y1973",
        "Y1974",
        "Y1975",
        "Y1976",
        "Y1977",
        "Y1978",
        "Y1979",
        "Y1980",
        "Y1981",
        "Y1982",
        "Y1983",
        "Y1984",
        "Y1985",
        "Y1986",
        "Y1987",
        "Y1988",
        "Y1989",
        "Y1990",
        "Y1991",
        "Y1992",
        "Y1993",
        "Y1994",
        "Y1995",
        "Y1996",
        "Y1997",
        "Y1998",
        "Y1999",
        "Y2000",
        "Y2001",
        "Y2002",
        "Y2003",
        "Y2004",
        "Y2005",
        "Y2006",
        "Y2007",
        "Y2008",
        "Y2009",
        "Y2010",
        "Y2011",
        "Y2012",
        "Y2013",
        "Y2014",
        "Y2015",
        "Y2016",
        "Y2017",
        "Y2018",
        "Y2019"
      ],
      "as": ["YearStr", "Change"]
    },
    {
      "calculate": "parseInt(substring(datum.YearStr, 1))",
      "as": "Year"
    }
  ],

  "encoding": {
    "color": {
      "condition": {
        "test": { "not": "datum.Year == YearFilter" },
        "value": "clear"
      },
      "field": "Change",
      "title": "Degrees",
      "type": "quantitative",
      "scale": {
        "type": "linear",
        "domain": [-1, 3],
        "range": [
          "#9aedff",
          "#ffff4a",
          "#ffcd00",
          "#ff7f00",
          "#ff0000",
          "#7f0000"
        ]
      }
    },
    "tooltip": [
      { "field": "properties.NAME", "type": "nominal", "title": "Country" },
      { "field": "Change", "type": "quantitative" }
    ]
  }
}
